<?php class Controller_Admin_Login_Index extends ypAdminController {	public function Index() {		if ($this->isLogin()) {			$this->redirect($this->Link->build('Admin/Index/Home', TRUE));		}		if ($this->User->isUser() AND !$this->User->isAdmin()) {			die("Stop!! Only admin access here!");		} 		$this->redirect($this->Link->build('Login/Index', TRUE, 			array('admin_login' => 1,				'redirect_to' => $this->Link->build($this->Link->this(), TRUE, $this->Link->getParams()))			));		die();		// Old version		$this->set('error', '');		$this->set('username', '');		$this->set('password', '');		$redirect_to = $this->Link->build('Admin/Index/Home', TRUE);		if ($this->Request->GET['redirect_to']) {			$redirect_to = $this->Request->GET['redirect_to'];		}		$this->set('redirect_to', $redirect_to);		if (!isset($this->Request->GET['is_redirect'])) {			$this->Link->addParam('hl', $this->Setting->get('admin_language'));			$this->Link->addParam('is_redirect', '1');			$this->Link->addParam('redirect_to', urlencode($redirect_to));			$this->Link->addParam('continue', '1');			$this->Link->addParam('module', 'Admin/Home');			$this->redirect($this->Link->build($this->Link->this(), TRUE, $this->Link->getParams()));		}		$this->loadLanguage('Admin/Login/Form');		$relogin = $this->Request->GET['relogin'];		if ((int) $relogin == TRUE) {			$username = $this->Db->e(htmlspecialchars(urldecode(trim((string) $this->Request->GET['admin_username']))));			$this->set('relogin', TRUE);			$this->set('username', $username);						$this->Link->removeParam('relogin');			$this->Link->removeParam('admin_username');			$link = $this->Link->build($this->Link->this(), TRUE, $this->Link->getParams());			$this->set('another_login_link', $this->Link->a($link, $this->_data['text_orther_login']));		}		$this->set('text_right_description', sprintf($this->_data['text_right_description'], 				$this->Link->build('Forgotpassword/Index'),				$this->Link->build('Index/Home')));		$this->setTemplate('module/Login/Form.php');		$this->Document->setTitle($this->_data['title']);		$this->set('form_action', $this->Link->build('Admin/Login/Progress', FALSE, $this->Link->getParams()));		$this->setTemplateChild(array(			'Admin/System/Header',			'Admin/System/Footer'		));		$this->Response->setOutput($this->render());	}}