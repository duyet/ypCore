<?phpclass Controller_Admin_Module_News_Edit extends ypAdminController {	public function Index() {		$this->checkLogin();		$postId = intval($this->Request->GET['id']);		if ($postId == 0) {			$this->redirect($this->Link->build('Admin/Module/News/Newpost'));		}		$this->Loader->model('Admin/Module/News/Edit');		$post = $this->Model_Admin_Module_News_Edit->loadPost($postId);		if (!$post) {			$this->redirect($this->Link->build('Admin/Module/News/Newpost'));		}		$this->set('post_title', $post['title']);		$this->set('post_id', $post['post_id']);		$this->set('post_content', $post['post']);		$this->set('cat', $post['cat_id']);		$this->set('keywork', $post['keywork']);		$this->set('time', date('H:i d/m/y', $post['post_date']));		$this->set('pub_date', $post['pub_date']);		$this->set('pub_time', $post['pub_time']);		$this->Loader->model('News/View');		$tags = $this->Model_News_View->getTags($post['post_id']);		$this->set('tags', implode(', ', $tags));		$this->loadLanguage('Admin/Module/News/Edit');		$this->set('form_action', $this->Link->build('Admin/Module/News/Edit/Progress'));		$this->Loader->model('Admin/Module/News/Newpost');		$this->set('cats', $this->Model_Admin_Module_News_Newpost->loadCat());		// ===============		$this->setTemplate('module/Module/News/Newpost.php');		$this->Document->setTitle($this->_data['title']);		$this->setTemplateChild(array(			'Admin/System/Header',			'Admin/System/Footer'		));		$this->Response->setOutput($this->render());	}		public function Progress() {		$this->checkLogin();		if (!$this->Request->POST['submit']) {			$this->redirect($this->Link->build('Admin/Module/News/Index', TRUE));		}		$this->loadLanguage('Admin/Module/News/EditProgress');		$this->Loader->helper('string');		$this->set('error', '');		$this->set('post_title',        (string) $this->Request->POST['post_title']);		$this->set('title_alias',       createAlias($this->_data['post_title']));		$this->set('post_id',           (int) $this->Request->POST['post_id']);		$this->set('post_content',      (string) htmlspecialchars($this->Request->POST['post_content']));		$this->set('cat',               (string) $this->Request->POST['cat']);		$this->set('keywork',           (string) $this->Request->POST['keywork']);		$this->set('tags',               (string) $this->Request->POST['tags']);		$this->set('post_date',          (int) $this->Request->POST['post_date']);		if (strlen($this->_data['post_title']) < 5 OR strlen($this->_data['post_title']) > 150) {			$this->set('error', $this->_data['error_title_strlen']);		} else {			if ($cat == '0') {				$this->set('error', $this->_data['error_chooose_cat']);			} else {				$this->Loader->model('Admin/Module/News/Progress');				$tags = array_map('trim', explode(',', $this->_data['tags']));				$this->set('user', $this->User->getData());				$postId = $this->Model_Admin_Module_News_Progress->editPost($this->_data);				if ($postId) {					$this->Model_Admin_Module_News_Progress->addTag($tags, $postId);				}				if (!$postId) {					// Add post fail					$this->set('error', $this->_data['error_add_post_fail']);				} else {					$this->set('redirect_to', $this->Link->build('Admin/Module/News/Index'));					$this->setTemplate('module/Module/News/Progress.php');					$this->Response->setOutput($this->render());					return;				}			}		}		if (!empty($this->_data['error'])) {			$this->loadLanguage('Admin/Module/News/Newpost');			$this->set('form_action', $this->Link->build('Admin/Module/News/Edit/Progress'));			$this->Loader->model('Admin/Module/News/Newpost');			$this->set('cats', $this->Model_Admin_Module_News_Newpost->loadCat());			$this->setTemplate('module/Module/News/Newpost.php');			$this->Document->setTitle($this->_data['title']);			$this->setTemplateChild(array(				'Admin/System/Header',				'Admin/System/Footer'			));			$this->Response->setOutput($this->render());		}	}	}