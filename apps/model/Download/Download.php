<?php class Model_Download_Download extends ypModel {	public function checkEmail($email) {		$this->Db->query("SELECT 1 FROM `yp_download_email_list` WHERE `email` = '". $this->Db->e($email) ."'");		if ($this->Db->num_rows() == 0) {			return FALSE;		}				return TRUE;	}		public function checkCode($code) {		if (empty($code)) {			return FALSE;		}		if (!preg_match('/^[A-z0-9]+$/', $code)) {			return FALSE;		}				$this->Db->query("SELECT * FROM `yp_download_list_waiting` WHERE `code` = '". $this->Db->e($code) ."'");		if ($this->Db->num_rows() == 0) {			return FALSE;		}				$result = $this->Db->fetch(); 		if ($result['active'] == '0') {			return FALSE;		}				return TRUE;	}		public function getFile($code) {		$this->Db->query("SELECT * 		FROM `yp_download_list_waiting` 		WHERE `code` = '". $this->Db->e($code) ."'");				$file = $this->Db->fetch();		if (!$file) return FALSE;				$this->Db->query("SELECT * 		FROM `yp_download_files` 		WHERE `id` = ". (int) $file['file_id']);		$file = array_merge($file, $this->Db->fetch());				return $file;	}		public function counter($file) {		// Update counter file 		$this->Db->query("UPDATE `yp_download_files` 		SET `download` = `download` + 1 		WHERE `id` = ". (int)$file['file_id']);				// Update counter email		$this->Db->query("UPDATE `yp_download_email_list`		SET `download` = `download` + 1		WHERE `email` = '". $this->Db->e($file['email']) ."'");				// De-active list waiting		if ((int)$file['active'] != 2) {			$this->Db->query("UPDATE `yp_download_list_waiting` 			SET `active` = 0			WHERE `code` = '". $this->Db->e($file['code']) ."'");		}	}}